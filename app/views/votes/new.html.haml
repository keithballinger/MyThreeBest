=javascript_include_tag 'contentflow'
=javascript_include_tag 'jquery.simplemodal.min'
%p Photos of #{@user.first_name}
.photos-box
  .ContentFlow
    .loadIndicator
      .indicator
    .flow
      - @photos.each do |photo|
        = image_tag photo.preview_url, :id => photo.id, :class => "item", :title => photo.title
    .globalCaption
    .scrollbar
      .slider
        .position
  %a{:href => "#", :id => "select-photo"} Select photo

.selected-photo{:class => (@first_voted.nil? ? "free": "used")}
  - if @first_voted
    = image_tag @first_voted.preview_url
    = link_to "Remove", delete_vote_path(@user.id, @first_voted.id), :class => "unvote-photo"
  - else
    %p Select a photo
.selected-photo{:class => (@second_voted.nil? ? "free": "used")}
  - if @second_voted
    = image_tag @second_voted.preview_url
    = link_to "Remove", delete_vote_path(@user.id, @second_voted.id), :class => "unvote-photo"
  - else
    %p Select a photo
.selected-photo{:class => (@third_voted.nil? ? "free": "used")}
  - if @third_voted
    = image_tag @third_voted.preview_url
    = link_to "Remove", delete_vote_path(@user.id, @third_voted.id), :class => "unvote-photo"
  - else
    %p Select a photo

#repeated-photo{:class => "alert-dialog simplemodal-data"}
  %p Photo already selected!!
  %a{:href => "#", :class => "simplemodal-close"} Accept

#vote-limit{:class => "alert-dialog simplemodal-data"}
  %p Three photos selected already!!
  %a{:href => "#", :class => "simplemodal-close"} Accept

:javascript
  $(document).ready(function() {
      $("#select-photo").click(function() {
          var selected = $(".active canvas");
          var photoId = selected.attr('id');
          var photo = selected.attr('src');
          var freePos = $(".free");
          var alreadySelected = $(".selected-photo img[src='"+photo+"']");
          if (freePos.length > 0) {
              if (alreadySelected.length == 0) {
                  $.get("/vote/"+#{@user.id}+"/"+photoId);
                  $(freePos[0]).html("<img src='"+photo+"' />"+
                                     "<a class='unvote-photo' id='"+photoId+"'href='/unvote/"+#{@user.id}+"/"+photoId+"'>Remove</a>");
                  $(freePos[0]).removeClass("free");
              } else {
                  $("#repeated-photo").modal();
              }
          } else {
              $("#vote-limit").modal();
          }
      });
      $(".unvote-photo").live('click', function(e){
          e.preventDefault();
          var url = $(this).attr("href");
          $.get(url);
          var parentDiv = $(this).parent();
          parentDiv.html("<p>Select a photo</p>");
          parentDiv.addClass("free");
      });
  });

